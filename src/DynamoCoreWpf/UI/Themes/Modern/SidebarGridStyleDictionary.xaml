<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:controls="clr-namespace:Dynamo.Controls;assembly=DynamoCoreWpf"
                    xmlns:ui="clr-namespace:Dynamo.UI;assembly=DynamoCoreWpf">

    <ResourceDictionary.MergedDictionaries>
        <ui:SharedResourceDictionary Source="{x:Static ui:SharedDictionaryManager.DynamoColorsAndBrushesDictionaryUri}" />
        <ui:SharedResourceDictionary Source="{x:Static ui:SharedDictionaryManager.DynamoConvertersDictionaryUri}" />
    </ResourceDictionary.MergedDictionaries>

    <!-- Region Control Templates-->

    <!-- Region LibraryView + LibrarySearchView-->

    <ControlTemplate x:Key="LibraryThumbTemplate"
                     TargetType="{x:Type Thumb}">
        <Grid>
            <Border x:Name="Rectangle1"
                    HorizontalAlignment="Right"
                    VerticalAlignment="Stretch"
                    Width="7"
                    Height="Auto"
                    Background="#aaaaaa"
                    Opacity="0.5"
                    CornerRadius="2" />
        </Grid>
    </ControlTemplate>

    <ControlTemplate x:Key="LibraryScrollBarTemplate"
                     TargetType="{x:Type ScrollBar}">
        <Grid x:Name="Bg"
              SnapsToDevicePixels="true"
              Background="Transparent">
            <Grid.RowDefinitions>
                <RowDefinition Height="0.00001*" />
            </Grid.RowDefinitions>
            <Track x:Name="PART_Track"
                   IsDirectionReversed="true"
                   IsEnabled="{TemplateBinding IsMouseOver}">
                <Track.Thumb>
                    <Thumb Template="{StaticResource LibraryThumbTemplate}" />
                </Track.Thumb>
            </Track>
        </Grid>
    </ControlTemplate>

    <ControlTemplate x:Key="LibraryScrollViewerControlTemplate"
                     TargetType="{x:Type ScrollViewer}">
        <Grid x:Name="Grid"
              Background="{TemplateBinding Background}">
            <Grid.ColumnDefinitions>
                <ColumnDefinition />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
                <RowDefinition />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>
            <ScrollContentPresenter x:Name="PART_ScrollContentPresenter"
                                    CanContentScroll="{TemplateBinding CanContentScroll}"
                                    CanHorizontallyScroll="False"
                                    CanVerticallyScroll="True"
                                    ContentTemplate="{TemplateBinding ContentTemplate}"
                                    Content="{TemplateBinding Content}"
                                    Grid.RowSpan="2"
                                    Margin="{TemplateBinding Padding}"
                                    Grid.ColumnSpan="2" />
            <ScrollBar x:Name="PART_VerticalScrollBar"
                       AutomationProperties.AutomationId="VerticalScrollBar"
                       Cursor="Arrow"
                       Grid.Column="1"
                       Maximum="{TemplateBinding ScrollableHeight}"
                       Minimum="0"
                       Grid.Row="0"
                       Visibility="{TemplateBinding ComputedVerticalScrollBarVisibility}"
                       Value="{Binding VerticalOffset, Mode=OneWay, RelativeSource={RelativeSource TemplatedParent}}"
                       ViewportSize="{TemplateBinding ViewportHeight}"
                       Width="8"
                       Style="{DynamicResource LibraryScrollBarStyle}" />
        </Grid>
    </ControlTemplate>

    <!--EndRegion-->

    <!--EndRegion-->

    <!-- Region Styles-->

    <!-- Region LibraryView + LibrarySearchView-->

    <!--Hide scrollbar, when mouse is not over.-->
    <Style x:Key="LibraryScrollViewerStyle"
           TargetType="ScrollViewer">
        <Setter Property="VerticalScrollBarVisibility"
                Value="Hidden" />
        <Style.Triggers>
            <Trigger Property="IsMouseOver"
                     Value="true">
                <Setter Property="VerticalScrollBarVisibility"
                        Value="Auto" />
            </Trigger>
        </Style.Triggers>
    </Style>

    <Style x:Key="LibraryScrollBarStyle"
           TargetType="{x:Type ScrollBar}">
        <Setter Property="Stylus.IsPressAndHoldEnabled"
                Value="false" />
        <Setter Property="Stylus.IsFlicksEnabled"
                Value="false" />
        <Setter Property="Foreground"
                Value="{DynamicResource {x:Static SystemColors.ControlTextBrushKey}}" />
        <Setter Property="Template"
                Value="{StaticResource LibraryScrollBarTemplate}" />
    </Style>

    <Style x:Key="LibraryExpandCollapseToggleStyle"
           TargetType="{x:Type ToggleButton}">
        <Setter Property="Focusable"
                Value="False" />
        <Setter Property="Width"
                Value="24" />
        <Setter Property="Height"
                Value="{Binding Path=ActualHeight, RelativeSource={RelativeSource AncestorType=Grid}}" />
        <Setter Property="Padding"
                Value="0" />
        <Setter Property="Margin"
                Value="0" />
        <Setter Property="VerticalAlignment"
                Value="Center" />
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type ToggleButton}">
                    <Border x:Name="ExpanderButtonBorder">
                        <Grid MinHeight="24"
                              MinWidth="66">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>

                            <Image x:Name="ExpandCollapseStateIcon"
                                   Source="pack://application:,,,/DynamoCoreWpf;component/UI/Images/collapsestate_normal.png"
                                   Width="16"
                                   Height="32"
                                   VerticalAlignment="Center" />
                            <TextBlock x:Name="HeaderContent"
                                              Grid.Column="1"
                                              Text="{Binding Name}"
                                              VerticalAlignment="Center"
                                              TextBlock.FontSize="13"
                                              TextBlock.Foreground="{StaticResource NestedMemberTextColor}"
                                              Margin="8,0,0,0" />
                        </Grid>
                    </Border>
                    <ControlTemplate.Triggers>

                        <MultiDataTrigger>
                            <MultiDataTrigger.Conditions>
                                <Condition Binding="{Binding RelativeSource={RelativeSource AncestorType=Grid}, 
                                                                         Path=IsMouseOver}"
                                           Value="True" />
                                <Condition Binding="{Binding RelativeSource={RelativeSource Self}, 
                                                                         Path=IsChecked}"
                                           Value="False" />
                            </MultiDataTrigger.Conditions>
                            <MultiDataTrigger.Setters>
                                <Setter Property="Source"
                                        TargetName="ExpandCollapseStateIcon"
                                        Value="pack://application:,,,/DynamoCoreWpf;component/UI/Images/collapsestate_hover.png" />
                            </MultiDataTrigger.Setters>
                        </MultiDataTrigger>

                        <MultiDataTrigger>
                            <MultiDataTrigger.Conditions>
                                <Condition Binding="{Binding RelativeSource={RelativeSource AncestorType=Grid}, 
                                                                         Path=IsMouseOver}"
                                           Value="True" />
                                <Condition Binding="{Binding RelativeSource={RelativeSource Self}, 
                                                                         Path=IsChecked}"
                                           Value="True" />
                            </MultiDataTrigger.Conditions>
                            <MultiDataTrigger.Setters>
                                <Setter Property="Source"
                                        TargetName="ExpandCollapseStateIcon"
                                        Value="pack://application:,,,/DynamoCoreWpf;component/UI/Images/expandstate_hover.png" />
                            </MultiDataTrigger.Setters>
                        </MultiDataTrigger>

                        <MultiDataTrigger>
                            <MultiDataTrigger.Conditions>
                                <Condition Binding="{Binding RelativeSource={RelativeSource AncestorType=Grid}, 
                                                                     Path=IsMouseOver}"
                                           Value="False" />
                                <Condition Binding="{Binding RelativeSource={RelativeSource Self}, 
                                                                     Path=IsChecked}"
                                           Value="True" />
                            </MultiDataTrigger.Conditions>
                            <MultiDataTrigger.Setters>
                                <Setter Property="Source"
                                        TargetName="ExpandCollapseStateIcon"
                                        Value="pack://application:,,,/DynamoCoreWpf;component/UI/Images/expandstate_normal.png" />
                            </MultiDataTrigger.Setters>
                        </MultiDataTrigger>

                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <ControlTemplate x:Key="LibraryToggleButtonTemplate"
                     TargetType="{x:Type ToggleButton}">
        <Border Name="Bd"
                BorderThickness="0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <Border BorderBrush="{StaticResource LibraryItemHostBackground}">
                    <Grid Background="Transparent">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>

                        <ToggleButton x:Name="Expander"
                                      Background="Transparent"
                                      IsHitTestVisible="False"
                                      Style="{StaticResource LibraryExpandCollapseToggleStyle}"
                                      ClickMode="Press"
                                      IsChecked="{Binding IsExpanded, Mode=OneWay}">
                            <ToggleButton.Margin>
                                <Binding Path="FullCategoryName"
                                         Converter="{StaticResource FullCategoryNameToMarginConverter}" />
                            </ToggleButton.Margin>
                        </ToggleButton>

                        <ContentPresenter Grid.Column="1"
                                          Grid.ColumnSpan="2"
                                          VerticalAlignment="Center" />

                        <Grid.Style>
                            <Style TargetType="{x:Type Grid}">
                                <Setter Property="Margin"
                                        Value="0,0,0,0" />
                                <Style.Triggers>
                                    <DataTrigger Value="True">
                                        <DataTrigger.Binding>
                                            <Binding RelativeSource="{RelativeSource Self}"
                                                     Path="DataContext"
                                                     Converter="{StaticResource RootElementToBoolConverter}" />
                                        </DataTrigger.Binding>
                                        <Setter Property="Margin"
                                                Value="5,0,0,0" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Grid.Style>
                    </Grid>

                    <Border.Style>
                        <Style TargetType="{x:Type Border}">
                            <Style.Triggers>

                                <!-- Root element & mouse over => dark grey + light border at the bottom. -->
                                <MultiDataTrigger>
                                    <MultiDataTrigger.Conditions>
                                        <Condition Binding="{Binding RelativeSource={RelativeSource Self},
                                                                                     Path=IsMouseOver}"
                                                   Value="True" />
                                        <Condition Binding="{Binding RelativeSource={RelativeSource Self},
                                                                                     Path=DataContext,
                                                                                     Converter={StaticResource RootElementToBoolConverter}}"
                                                   Value="True" />
                                    </MultiDataTrigger.Conditions>
                                    <MultiDataTrigger.Setters>
                                        <Setter Property="BorderThickness"
                                                Value="0,0,0,1" />
                                        <Setter Property="Background"
                                                Value="{StaticResource RootElementOnHover}" />
                                    </MultiDataTrigger.Setters>
                                </MultiDataTrigger>

                                <!-- Usual element & mouse over => light grey. -->
                                <MultiDataTrigger>
                                    <MultiDataTrigger.Conditions>
                                        <Condition Binding="{Binding RelativeSource={RelativeSource Self},
                                                                                     Path=IsMouseOver}"
                                                   Value="True" />
                                        <Condition Binding="{Binding RelativeSource={RelativeSource Self},
                                                                                     Path=DataContext,
                                                                                     Converter={StaticResource RootElementToBoolConverter}}"
                                                   Value="False" />
                                    </MultiDataTrigger.Conditions>
                                    <MultiDataTrigger.Setters>
                                        <Setter Property="Background"
                                                Value="{StaticResource LibraryMemberOnHover}" />
                                    </MultiDataTrigger.Setters>
                                </MultiDataTrigger>

                                <!-- Usual element & mouse not over => grey. -->
                                <MultiDataTrigger>
                                    <MultiDataTrigger.Conditions>
                                        <Condition Binding="{Binding RelativeSource={RelativeSource Self},
                                                                                     Path=IsMouseOver}"
                                                   Value="False" />
                                        <Condition Binding="{Binding RelativeSource={RelativeSource Self},
                                                                                     Path=DataContext,
                                                                                     Converter={StaticResource RootElementToBoolConverter}}"
                                                   Value="False" />
                                    </MultiDataTrigger.Conditions>
                                    <MultiDataTrigger.Setters>
                                        <Setter Property="Background"
                                                Value="{StaticResource LibraryItemHostBackground}" />
                                    </MultiDataTrigger.Setters>
                                </MultiDataTrigger>

                                <!-- Root element & mouse not over => dark dark grey + light border at the bottom. -->
                                <MultiDataTrigger>
                                    <MultiDataTrigger.Conditions>
                                        <Condition Binding="{Binding RelativeSource={RelativeSource Self},
                                                                                     Path=IsMouseOver}"
                                                   Value="False" />
                                        <Condition Binding="{Binding RelativeSource={RelativeSource Self},
                                                                                     Path=DataContext,
                                                                                     Converter={StaticResource RootElementToBoolConverter}}"
                                                   Value="True" />
                                    </MultiDataTrigger.Conditions>
                                    <MultiDataTrigger.Setters>
                                        <Setter Property="BorderThickness"
                                                Value="0,0,0,1" />
                                        <Setter Property="Background"
                                                Value="{StaticResource RootElementBackground}" />
                                    </MultiDataTrigger.Setters>
                                </MultiDataTrigger>

                            </Style.Triggers>
                        </Style>
                    </Border.Style>
                </Border>

                <Border Grid.Row="1"
                        Background="{StaticResource LibraryItemHostBackground}">
                    <ItemsPresenter x:Name="ItemsHost">
                        <ItemsPresenter.Visibility>
                            <Binding Converter="{StaticResource LibraryTreeItemsHostVisibilityConverter}" />
                        </ItemsPresenter.Visibility>

                        <ItemsPresenter.Style>
                            <Style TargetType="{x:Type ItemsPresenter}">
                                <Setter Property="Margin"
                                        Value="0,0,0,0" />
                                <Style.Triggers>
                                    <DataTrigger Value="True">
                                        <DataTrigger.Binding>
                                            <Binding RelativeSource="{RelativeSource Self}"
                                                     Path="DataContext"
                                                     Converter="{StaticResource RootElementToBoolConverter}" />
                                        </DataTrigger.Binding>
                                        <Setter Property="Margin"
                                                Value="0,3,0,3" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </ItemsPresenter.Style>

                    </ItemsPresenter>
                </Border>
            </Grid>
        </Border>
    </ControlTemplate>

    <!--EndRegion-->

    <!--EndRegion-->

</ResourceDictionary>