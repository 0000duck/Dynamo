<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
  
  <Product Id="*" 
           Name="Dynamo" 
           Language="1033" 
           Version="0.7.1" 
           Manufacturer="Dynamo" 
           UpgradeCode="f84e2239-049c-43cb-b875-ada28893a9db">

    <Package InstallerVersion="200" 
             Compressed="yes" 
             InstallScope="perMachine" 
             Platform="x64"/>

    <MajorUpgrade 
      Schedule="afterInstallInitialize"
      DowngradeErrorMessage="A newer version of [ProductName] is already installed." />
    
    <MediaTemplate EmbedCab="yes" />

    <UIRef Id="WixUI_FeatureTree"/>
    <WixVariable Id="WixUILicenseRtf" Value="$(env.DYNAMO_BASE)\doc\distrib\License.rtf" />

    <!--Property used to define on which version of Revit to install.-->
    <Property Id="REVIT_FLAVOR" Value="Autodesk Revit Architecture 2015"/>

    <!--Find Revit installations by finding the uninstall registry key.-->
    <Property Id="VASARI">
      <RegistrySearch Id='VasariRegistry_2014' Type='raw' Win64='yes'
        Root='HKLM' Key='SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\Autodesk Vasari Beta 3' Name='InstallLocation' />
    </Property>
    
    <Property Id="REVIT_2014">
      <RegistrySearch Id='RevitRegistry_2014' Type='raw' Win64='yes'
        Root='HKLM' Key='SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\Autodesk Revit 2014' Name='InstallLocation' />
    </Property>
    
    <Property Id="REVIT_ARCHITECTURE_2014">
      <RegistrySearch Id='RevitRegistry_Architecture_2014' Type='raw' Win64='yes'
        Root='HKLM' Key='SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\Autodesk Revit Architecture 2014' Name='InstallLocation' />
    </Property>
    
    <Property Id="REVIT_2015">
      <RegistrySearch Id='RevitRegistry_2015' Type='raw' Win64='yes'
        Root='HKLM' Key='SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\Autodesk Revit 2015' Name='InstallLocation' />
    </Property>
    
    <Property Id="REVIT_ARCHITECTURE_2015">
      <RegistrySearch Id='RevitRegistry_Architecture_2015' Type='raw' Win64='yes'
        Root='HKLM' Key='SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\Autodesk Revit Architecture 2015' Name='InstallLocation' />
    </Property>

    <Property Id="DYNAMO_INSTALLDIR">
      <RegistrySearch Id='RevitForDynamo' Type='raw' Win64='yes'
        Root='HKLM' Key='SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\[REVIT_FLAVOR]' Name='InstallLocation' />
    </Property>
    
    <Feature Id="DYNAMO_CORE_FEATURE" 
             Title="Dynamo Core" 
             Level="1">
      <ComponentGroupRef Id="RELEASE"/>
      <ComponentGroupRef Id="DEFINITIONS"/>
      <Feature Id="DYNAMO_CORE_SAMPLES"
             Title="Sample Content"
             Level="1" >
        <ComponentGroupRef Id="SAMPLES"/>
      </Feature>
    </Feature>
    
    <Feature Id="DYNAMO_REVIT_2014" 
             Title="Dynamo for Revit 2014" 
             Level="1">
      <ComponentGroupRef Id="REVIT_2014"/>
      <Condition Level="0">REVIT_ARCHITECTURE_2014=""</Condition>
    </Feature>
    
    <Feature Id="DYNAMO_REVIT_2015" 
             Title="Dynamo for Revit 2015"
             Level="1">
      <ComponentGroupRef Id="REVIT_2015"/>
      <Condition Level="0">REVIT_ARCHITECTURE_2015=""</Condition>
    </Feature>

    <Icon Id="DynamoInstaller.ico" SourceFile="$(var.SolutionDir)..\tools\install\Extra\DynamoInstaller.ico"/>
    <Property Id="ARPPRODUCTICON" Value="DynamoInstaller.ico" />
  
  </Product>

  <Fragment>
    <Directory Id="TARGETDIR" Name="SourceDir">
        <Directory Id="DYNAMO_INSTALLDIR">
        </Directory>
      <Directory Id="CommonAppDataFolder">
        <Directory Id="DYNAMO_PROGDATA" Name="Dynamo">
          <Directory Id="PROGDATA_07" Name="0.7"/>
        </Directory>
      </Directory>
    </Directory>
  </Fragment>

</Wix>